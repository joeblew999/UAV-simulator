version: '3'

vars:
  ROOT_DIR: '{{.ROOT_DIR | default "."}}'
  SRC_DIR: '{{.ROOT_DIR}}/.src'
  VOXEL_DIR: '{{.SRC_DIR}}/voxel-fun'
  VOXEL_REPO: https://github.com/pawel-dubiel/voxel-fun.git

tasks:
  debug:
    desc: Print all vars for debugging
    cmds:
      - echo "=== Vars ==="
      - echo "ROOT_DIR={{.ROOT_DIR}}"
      - echo "SRC_DIR={{.SRC_DIR}}"
      - echo "VOXEL_DIR={{.VOXEL_DIR}}"
      - echo "VOXEL_REPO={{.VOXEL_REPO}}"
    silent: true

  clone:
    desc: Clone voxel-fun repository
    status:
      - test -d {{.VOXEL_DIR}}
    cmds:
      - mkdir -p {{.SRC_DIR}}
      - git clone {{.VOXEL_REPO}} {{.VOXEL_DIR}}

  pull:
    desc: Pull latest voxel-fun changes
    cmds:
      - cd {{.VOXEL_DIR}} && git pull

  deps:install:
    desc: Install voxel-fun dependencies
    deps:
      - clone
    cmds:
      - cd {{.VOXEL_DIR}} && bun install

  deps:clean:
    desc: Remove voxel-fun source directory
    cmds:
      - rm -rf {{.SRC_DIR}}

  start:
    desc: Start voxel-fun visualizer
    deps:
      - deps:install
    cmds:
      - cd {{.VOXEL_DIR}} && bun run dev

  stop:
    desc: Stop voxel-fun visualizer
    cmds:
      - pkill -f "bun run dev" || true
