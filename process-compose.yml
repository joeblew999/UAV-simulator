version: "0.5"

# Load environment variables from .env file
env_file: .env

processes:
  nats-server:
    command: task nats-server:start
    readiness_probe:
      exec:
        command: task nats-cli:rtt
      initial_delay_seconds: 1
      period_seconds: 2

  main:
    command: task main:start
    depends_on:
      nats-server:
        condition: process_healthy
    environment:
      - TERM=xterm-256color

  # Optional: telemetry watcher (uncomment to auto-subscribe)
  # telemetry:
  #   command: task nats-cli:sub
  #   depends_on:
  #     nats-server:
  #       condition: process_healthy

  # Voxel-fun 3D visualizer
  voxel:
    command: task voxel:start
    depends_on:
      nats-server:
        condition: process_healthy

  # Narun HTTP/gRPC gateway to NATS
  narun:
    command: task narun:start
    depends_on:
      nats-server:
        condition: process_healthy
